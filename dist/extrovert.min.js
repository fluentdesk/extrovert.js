/*! extrovert.js 20-07-2019 */
!function(a,b){"function"==typeof define&&define.amd?define(["three","physijs"],b):a.extrovert=b(a.THREE,a.Physijs)}(this,function(a,b){var c,d,e;return function(a){function b(a,b){return v.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b&&b.split("/"),p=t.map,q=p&&p["*"]||{};if(a){for(a=a.split("/"),g=a.length-1,t.nodeIdCompat&&x.test(a[g])&&(a[g]=a[g].replace(x,"")),"."===a[0].charAt(0)&&o&&(n=o.slice(0,o.length-1),a=n.concat(a)),k=0;k<a.length;k++)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(0===k||1===k&&".."===a[2]||".."===a[k-1])continue;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((o||q)&&p){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),o)for(l=o.length;l>0;l-=1)if(e=p[o.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=w.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),o.apply(a,d.concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){r[a]=b}}function j(c){if(b(s,c)){var d=s[c];delete s[c],u[c]=!0,n.apply(a,d)}if(!b(r,c)&&!b(u,c))throw new Error("No "+c);return r[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return a?k(a):[]}function m(a){return function(){return t&&t.config&&t.config[a]||{}}}var n,o,p,q,r={},s={},t={},u={},v=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;p=function(a,b){var c,d=k(a),e=d[0],g=b[1];return a=d[1],e&&(e=f(e,g),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(g)):f(a,g):(a=f(a,g),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},q={require:function(a){return g(a)},exports:function(a){var b=r[a];return"undefined"!=typeof b?b:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:m(a)}}},n=function(c,d,e,f){var h,k,m,n,o,t,v,w=[],x=typeof e;if(f=f||c,t=l(f),"undefined"===x||"function"===x){for(d=!d.length&&e.length?["require","exports","module"]:d,o=0;o<d.length;o+=1)if(n=p(d[o],t),k=n.f,"require"===k)w[o]=q.require(c);else if("exports"===k)w[o]=q.exports(c),v=!0;else if("module"===k)h=w[o]=q.module(c);else if(b(r,k)||b(s,k)||b(u,k))w[o]=j(k);else{if(!n.p)throw new Error(c+" missing "+k);n.p.load(n.n,g(f,!0),i(k),{}),w[o]=r[k]}m=e?e.apply(r[c],w):void 0,c&&(h&&h.exports!==a&&h.exports!==r[c]?r[c]=h.exports:m===a&&v||(r[c]=m))}else c&&(r[c]=e)},c=d=o=function(b,c,d,e,f){if("string"==typeof b)return q[b]?q[b](c):j(p(b,l(c)).f);if(!b.splice){if(t=b,t.deps&&o(t.deps,t.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?n(a,b,c,d):setTimeout(function(){n(a,b,c,d)},4),o},o.config=function(a){return o(a)},c._defined=r,e=function(a,c,d){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]),b(r,a)||b(s,a)||(s[a]=[a,c,d])},e.amd={jQuery:!0}}(),e("../bower_components/almond/almond",function(){}),e("extrovert/options/version",{major:0,minor:1,patch:3,str:"0.1.3"}),e("extrovert/options/defaults",{renderer:"Any",gravity:[0,0,0],camera:{fov:35,near:1,far:1e4,position:[0,0,200]},controls:{type:"universal",enabled:!0,allow_drag:!1},physics:{provider:"physijs",enabled:!0,options:{worker:"/js/pjsworker.js",ammo:"ammo.js"}},block:{depth:1},move_with_physics:!0,clickForce:9e5,onload:null,onerror:null,created:null,clicked:null,lights:[{type:"ambient",color:16777215}]}),e("extrovert/utilities/is",[],function(){return{array:function(a){return"[object Array]"===Object.prototype.toString.call(a)},string:function(){return"string"==typeof object},plainObject:function(a){return"object"!=typeof a||a.nodeType||null!==a&&a===a.window?!1:a.constructor&&!hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf")?!1:!0}}}),e("extrovert/utilities/extend",["./is"],function(a){var b=function c(){var b,d,e,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[j]||{},j++),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!==(b=arguments[j]))for(d in b)e=i[d],f=b[d],i!==f&&(l&&f&&(a.plainObject(f)||(g=f.constructor===Array))?(g?(g=!1,h=e&&e.constructor===Array?e:[]):h=e&&a.plainObject(e)?e:{},i[d]=c(l,h,f)):void 0!==f&&(i[d]=f));return i};return b}),e("extrovert/options/options",["./defaults","../utilities/extend"],function(a,b){function c(c){return d.user=c,d.merged=b(!0,{},a,c),d.merged}var d={init:c,defaults:a,user:null,merged:null};return d}),e("extrovert/utilities/cookie",[],function(){return{getCookie:function(a){a=a.toLowerCase();for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].split("="),e=decodeURIComponent(d[0].trim().toLowerCase()),f=d.length>1?d[1]:"";if(e==a)return decodeURIComponent(f)}return""},setCookie:function(a,b){var c=new Date;c.setYear(c.getFullYear()+1);var d=encodeURIComponent(a)+"="+encodeURIComponent(b)+";expires="+c.toGMTString()+";path=/";document.cookie=d},clearCookie:function(a){my.setCookie(a,"")}}}),e("extrovert/utilities/getComputedStyle",[],function(){return function(a,b){var c,d=a.ownerDocument.defaultView;return d&&d.getComputedStyle?(b=b.replace(/([A-Z])/g,"-$1").toLowerCase(),d.getComputedStyle(a,null).getPropertyValue(b)):a.currentStyle?(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b],/^\d+(em|pt|%|ex)?$/i.test(c)?function(b){var c=a.style.left,d=a.runtimeStyle.left;return a.runtimeStyle.left=a.currentStyle.left,a.style.left=b||0,b=a.style.pixelLeft+"px",a.style.left=c,a.runtimeStyle.left=d,b}(c):c):void 0}}),e("extrovert/utilities/detect",[],function(){return{supportsWebGL:function(a){if(window.WebGLRenderingContext){for(var b=document.createElement("canvas"),c=["webgl","experimental-webgl","moz-webgl","webkit-3d"],d=!1,e=0;4>e;e++)try{if(d=b.getContext(c[e]),d&&"function"==typeof d.getParameter)return a?{name:c[e],gl:d}:!0}catch(f){}return!1}return!1},supportsCanvas:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}}}),function(a,b){"use strict";"function"==typeof e&&e.amd?e("in.scribe",[],b):"object"==typeof exports?module.exports=b():a.inscribe=b()}(window,function(){"use strict";var a=function(){return{inscribe:function(b,c,d,e){a["_render"+(c||"text")].call(this,d,b,e)}}};return a._rendertext=function(a,b,c){function d(b,d){a.fillText(b,h[0],h[1]),c.lineEmitted&&c.lineEmitted(b,j),(j%c.chunkSize===c.chunkSize-1||d)&&(c.pageEmitted&&(a=c.pageEmitted(a)),h[0]=h[1]=e),h[1]+=g,++j}var e=c.padding||10,f=c.maxWidth?c.maxWidth-2*e:492,g=c.lineHeight||16,h=[e,e+g],i=b.split("\n"),j=0;return i.reduce(function(b,e,g){var h=e.split(" "),j="";h[0]=(c.firstLineIndent||"   ")+h[0];for(var k=0;k<h.length;k++){var l=j+(j.length>0?" ":"")+h[k],m=a.measureText(l),n=m.width>f;!n&&(j=l,k<h.length-1)||(d(j,!1),j=n?h[k]:"")}g===i.length-1&&d(j,!0)},{}),{numLines:j}},a._renderhtml=function(){},a._renderdom=function(){},a}),e("extrovert/utilities/utils",["require","three","./cookie","./getComputedStyle","./detect","in.scribe"],function(a,b,c,d,e,f){var g;return{VZERO:new b.Vector3(0,0,0),shadeBlend:a("./blend"),getCookie:c.getCookie,setCookie:c.setCookie,clearCookie:c.clearCookie,getComputedStyle:d,wrapText:(new f).wrapText,detectWebGL:e.supportsWebGL,detectCanvas:e.supportsCanvas,registerEvent:function(a){var b=!0;return g=g||{},g[a]=b?document.createEvent("Event"):new Event(a),b&&g[a].initEvent(a,!0,!0),g[a]},fireEvent:function(a){document.dispatchEvent(g[a])}}}),e("extrovert/utilities/sel",[],function(){return function(a){return document.querySelectorAll(a)}}),e("extrovert/utilities/log",[],function(){return{msg:function(){var a=Array.prototype.slice.call(arguments);a[0]="EXTRO: "+a[0],console.log.apply(console,a)},warn:function(){var a=Array.prototype.slice.call(arguments);a[0]="EXTRO: "+a[0],console.warn.apply(console,a)},error:function(){var a=Array.prototype.slice.call(arguments);a[0]="EXTRO: "+a[0],console.error.apply(console,a)}}}),e("extrovert/utilities/offset",[],function(){return function(a){var b,c,d={top:0,left:0},e=a&&a.ownerDocument;return e?(b=e.documentElement,void 0!==a.getBoundingClientRect&&(d=a.getBoundingClientRect()),c=null!==e&&e===e.window?e:9===e.nodeType&&e.defaultView,{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}):void 0}}),e("extrovert/providers/three/provider-three",["extrovert/options/options","three","physijs"],function(a,b,c){"use strict";function d(d,e,f,g,h){return a.merged.physics.enabled&&!g?new c[e+"Mesh"](d,f,h):new b.Mesh(d,f)}function e(a){var c=new b.SpotLight(a.color);return c.shadowCameraVisible=!1,c}var f={};return f.createCamera=function(a){var c="orthographic"!=a.type?new b.PerspectiveCamera(a.fov,a.aspect,a.near,a.far):new b.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);return a.position&&c.position.set(a.position[0],a.position[1],a.position[2]),a.up&&c.up.set(a.up[0],a.up[1],a.up[2]),a.lookat&&c.lookAt(new b.Vector3(a.lookat[0],a.lookat[1],a.lookat[2])),c.updateMatrix(),c.updateMatrixWorld(),c.updateProjectionMatrix(),c},f.createMaterial=function(d){var e=new b.MeshLambertMaterial({color:d.color||16777215,map:d.tex||null});return a.merged.physics.enabled&&!d.noPhysics?c.createMaterial(e,d.friction||.2,d.restitution||1):e},f.createMaterialFromCanvas=function(a,c){var d=new b.Texture(a);return d.needsUpdate=c||!1,{tex:d,mat:new b.MeshLambertMaterial({map:tex})}},f.loadTexture=function(a){return b.ImageUtils.loadTexture(a)},f.createTextureFromCanvas=function(a,c){var d=new b.Texture(a);return d.needsUpdate=c||!1,d},f.createCubeMaterial=function(a){return new b.MeshFaceMaterial(a)},f.createObject=function(a){var c=null,e=null,f=null,g=a.color||16777215,h=a.opacity||1,i=a.transparent||!1;return"box"===a.type?(e=new b.BoxGeometry(a.dims[0],a.dims[1],a.dims[2]),f=a.mat||new b.MeshLambertMaterial({color:g,opacity:h,transparent:i}),c=d(e,"Box",f,!1,a.mass)):"plane"===a.type&&(e=new b.PlaneBufferGeometry(a.dims[0],a.dims[1]),f=a.mat||new b.MeshBasicMaterial({color:g,opacity:h,transparent:i}),c=d(e,null,f,!0,a.mass)),a.pos&&c.position.set(a.pos[0],a.pos[1],a.pos[2]),a.rot&&c.rotation.set(a.rot[0],a.rot[1],a.rot[2],"YXZ"),a.visible===!1&&(c.visible=!1),c.castShadow=c.receiveShadow=!1,c},f.fiatLux=function(a){if(a&&0!==a.length){for(var c=[],d=null,f=0;f<a.length;f++){var g=a[f];if("ambient"===g.type)d=new b.AmbientLight(g.color);else if("point"===g.type)d=new b.PointLight(g.color,g.intensity,g.distance);else if("spotlight"===g.type)d=e(g);else{if("hemisphere"!==g.type)return;d=new b.HemisphereLight(g.color,g.groundColor,g.intensity)}"ambient"!==g.type&&"hemisphere"!==g.type&&(g.pos?d.position.set(g.pos[0],g.pos[1],g.pos[2]):d.position.copy(eng.camera.position)),c.push(d)}return c}},f}),e("extrovert/rasterizers/paint-img",["extrovert/providers/three/provider-three"],function(a){"use strict";return{paint:function(b){return a.loadTexture("string"==typeof b?b:b.src)}}}),e("extrovert/rasterizers/paint-element",["extrovert/providers/three/provider-three","extrovert/utilities/utils"],function(a,b){"use strict";return{paint:function(c){var d=document.createElement("canvas"),e=d.getContext("2d");d.width=c.offsetWidth,d.height=c.offsetHeight;var f=b.getComputedStyle(c,"background-color");return"rgba(0, 0, 0, 0)"===f&&(f="rgb(0,0,0)"),e.fillStyle=f,e.fillRect(0,0,d.width,d.height),a.createTextureFromCanvas(d,!0)}}}),e("extrovert/utilities/blend",[],function(){return function(a,b,c){var d=0>a?-1*a:a,e=Math.round,f=parseInt;if(b.length>7){var g=b.split(","),h=(c?c:0>a?"rgb(0,0,0)":"rgb(255,255,255)").split(","),i=f(g[0].slice(4)),j=f(g[1]),k=f(g[2]);return"rgb("+(e((f(h[0].slice(4))-i)*d)+i)+","+(e((f(h[1])-j)*d)+j)+","+(e((f(h[2])-k)*d)+k)+")"}var g=f(b.slice(1),16),h=f((c?c:0>a?"#000000":"#FFFFFF").slice(1),16),l=g>>16,m=g>>8&255,n=255&g;return"#"+(16777216+65536*(e(((h>>16)-l)*d)+l)+256*(e(((h>>8&255)-m)*d)+m)+(e(((255&h)-n)*d)+n)).toString(16).slice(1)}}),e("extrovert/rasterizers/paint-plain-text",["../utilities/utils","../providers/three/provider-three","../utilities/blend","in.scribe"],function(a,b,c,d){"use strict";return{paint:function(e,f,g){f=f||{};var h=document.createElement("canvas"),i=h.getContext("2d");h.width=f.width,h.height=f.height;var j=f.bkColor||"rgb(255,255,255)";i.fillStyle=j,i.fillRect(0,0,h.width,h.height),i.font=a.getComputedStyle(document.body,"font"),i.fillStyle=f.bkColor||"rgb(0,0,0)";var k=14,l=new d,m=l.wrapText(i,e.title,10,10+k,h.width-20,k,!0);i.fillStyle=c(-.25,j),i.fillRect(0,0,h.width,20+m*k),i.fillStyle=f.textColor||"rgb(255,255,255)",m=l.wrapText(i,e.title,10,10+k,h.width-20,k,!1);var n=16,o=e.text.replace("\n"," ");return m=l.wrapText(i,o,10,20+m*k+n,h.width-20,n,!1),g.numLines=m,b.createTextureFromCanvas(h,!0)}}}),e("extrovert/rasterizers/paint-plain-text-stream",["extrovert/utilities/utils","extrovert/providers/three/provider-three","in.scribe"],function(a,b,c){"use strict";return{paint:function(d,e,f){e=e||{};var g=new c,h=[],i=e.lineHeight||16,j=d.text,k=e.padding||10;f.numLines=0;var l=document.createElement("canvas"),m=l.getContext("2d");l.width=e.width,l.height=e.height;var n=e.bkColor||"rgb(255,255,255)";return m.fillStyle=n,m.fillRect(0,0,l.width,l.height),m.font=a.getComputedStyle(document.body,"font"),m.fillStyle=e.bkColor||"rgb(0,0,0)",g.inscribe(j,"text",m,{padding:k,maxWidth:l.width,lineHeight:i,chunkSize:35,pageEmitted:function(c){h.push(b.createTextureFromCanvas(c.canvas,!0));var d=document.createElement("canvas");d.width=e.width,d.height=e.height;var f=d.getContext("2d"),g=e.bkColor||"rgb(255,255,255)";return f.fillStyle=g,f.fillRect(0,0,d.width,d.height),f.font=a.getComputedStyle(document.body,"font"),f.fillStyle=e.textColor||"rgb(0,0,0)",f}}),h}}}),e("extrovert/generators/book",["require","../core","../utilities/log","extrovert/providers/three/provider-three"],function(a,b,c,d){"use strict";function e(a,b,c){for(var d=0;d<a.faces.length;d++){var e=a.faceVertexUvs[0][d];if(Math.abs(a.faces[d].normal.z)>.9)for(var f=0;3>f;f++)Math.abs(e[f].y)<.01&&(e[f].y=1-b/c)}a.uvsNeedUpdate=!0}var f=null,g=null,h=null,i=null,j=function(){{var b=a("../core");a("../utilities/utils")}return{options:{name:"book",material:{color:16777215,friction:.2,restitution:1},block:{depth:"height"},clickForce:5e3,dims:[512,814,2],pagify:!0,title:null,cover:null,doubleSided:!0,camera:{position:[0,0,400]}},init:function(a,c){f=a,g=c,b.createPlacementPlane([0,0,200]),h=d.createMaterial({color:a.pageColor||a.material.color,friction:a.material.friction,restitution:a.material.restitution})},generate:function(a,j){function k(a){return d.createMaterial({tex:a,friction:.2,restitution:1})}function l(a,b){return b%2===0}function m(a,b){return!l(a,b)}if(b.LOGGING&&c.msg("book.generate( %o, %o )",a,j),i=a,a.cover){var n=d.createMaterial({tex:d.loadTexture(a.cover),friction:.2,resitution:1});b.createObject({type:"box",pos:[0,0,0],dims:f.dims,mat:n,mass:1e3})}for(var o=0;o<j.length;o++){var p=a.adapt&&a.adapt(j[o])||j[o],q=null;if(q=a.rasterizer?"string"==typeof a.rasterizer?g.rasterizers[a.rasterizer]:a.rasterizer:g.rasterizers.paint_plain_text_stream,f.pagify)for(var r={},s={width:f.texWidth||512,height:f.texHeight||1024,bkColor:f.pageColor||f.material&&f.material.color||16777215,textColor:f.textColor||2302755},t=q.paint(p,s,r),u=t.map(k),v=u.filter(l),w=u.filter(m),x=0;x<v.length;x++){var y=[0,0,-(x*f.dims[2])-f.dims[2]],z=[h,h,h,h,v[x],x<w.length?w[x]:h],A=d.createCubeMaterial(z),B=b.createObject({type:"box",pos:y,dims:f.dims,mat:A,mass:1e3});e(B.geometry,s.width,s.height),b.LOGGING&&c.msg("Generating page %o at position %f, %f, %f",B,y[0],y[1],y[2])}}}}};return j}),e("extrovert/generators/box",["extrovert/core"],function(a){"use strict";var b,c,d,e;return{options:{name:"box",material:{color:16746564,friction:.2,restitution:1},block:{width:250,height:250,depth:250}},init:function(e,f){b=e,c=f,d=a.provider.createMaterial(e.material),a.createPlacementPlane([0,0,0])},generate:function(c,f){e=c;var g,h,i;if(1===f.length)i=this.rasterize(f[0]),g=[i,i,i,i,i,i];else if(2===f.length)i=this.rasterize(f[0]),material2=this.rasterize(f[1]),g=[d,d,d,d,i,material2];else if(f.length>2){g=[];for(var j=f.length>6?6:f.length,k=0;j>k;k++)h=f[k],i=this.rasterize(h),g.push(i);for(;6!==g.length;)g.push(d)}var l=a.createCubeMaterial(g);a.createObject({type:"box",pos:[0,0,0],dims:[b.block.width,b.block.height,b.block.depth],mat:l,mass:1e3})},rasterize:function(c){var d=null;e.rasterizer&&(d="string"==typeof e.rasterizer?new a["paint_"+e.rasterizer]:e.rasterizer),d=d||a.getRasterizer(c);var f=d.paint(e.adapt&&e.adapt(c)||c,{width:b.block.width,height:b.block.height}),g=a.provider.createMaterial({tex:f,friction:.2,restitution:1});return g}}}),e("extrovert/generators/direct",["extrovert/core","extrovert/providers/three/provider-three"],function(a,b){"use strict";var c=function(){var a,c,e,f,g=d("extrovert/core");return{options:{name:"direct",material:{color:16746564,friction:.2,restitution:1},block:{depth:10},map:"fit"},init:function(d,f){a=d,c=f,e=b.createMaterial(d.material),g.createPlacementPlane([0,0,0])},generate:function(a,b){f=a;for(var c=0;c<b.length;c++){var d=b[c],e=this.transform(d),h=this.rasterize(d);g.createObject({type:"box",pos:e.pos,dims:[e.width,e.height,e.depth],mat:h,mass:1e3})}},transform:function(b){var d=f.container||c.opts.src&&c.opts.src.container||document.body;return g.getPositionDirect(b,d,a.block.depth,0)},rasterize:function(c){var d=null;f.rasterizer&&(d="string"==typeof f.rasterizer?g[f.rasterizer]:f.rasterizer),d=d||g.getRasterizer(c);var h=d.paint(f.adapt&&f.adapt(c)||c),i=b.createMaterial({tex:h,friction:.2,restitution:0});if(!a.map||"all"===a.map)return i;var j;return"fit"==a.map&&(j=a.block.depth&&"height"!==a.block.depth?"width"===a.block.depth?[i,i,e,e,i,i]:[e,e,e,e,i,i]:[e,e,i,i,i,i]),b.createCubeMaterial(j)}}};return c}),e("extrovert/generators/extrude",["require","extrovert/core","extrovert/providers/three/provider-three"],function(a,b,c){"use strict";var d,e,f,g,h=function(){var b=a("extrovert/core");return{options:{name:"extrude",material:{color:16746564,friction:.2,restitution:1},depth:1,map:"fit"},init:function(a,g){d=a,e=g,f=c.createMaterial(a.material),b.createPlacementPlane([0,0,0])},generate:function(a,c){g=a;var d=null;if("content-bottom"==g.align){d=0;for(var e=0;e<c.length;e++){var f=$(c[e]),h=f.offset().top+f.height();h>d&&(d=h)}console.log("Floor is "+d)}for(var i=0;i<c.length;i++){var j=c[i],k=this.transform(j,d),l=this.rasterize(j);b.createObject({type:"box",pos:k.pos,dims:[k.width,k.height,k.depth],mat:l,mass:1e3})}},transform:function(a,c){var f=g.container||e.opts.src&&e.opts.src.container||document.body;return b.getPosition(a,f,d.depth,c)},rasterize:function(a){var h=null;g.rasterizer&&(h="string"==typeof g.rasterizer?e.rasterizers[g.rasterizer]:g.rasterizer),h=h||b.getRasterizer(a);var i=h.paint(g.adapt&&g.adapt(a)||a),j=c.createMaterial({tex:i,friction:.2,restitution:0});if(!d.map||"all"===d.map)return j;var k;return"fit"==d.map&&(k=d.depth&&"height"!==d.depth?"width"===d.depth?[j,j,f,f,j,j]:[f,f,f,f,j,j]:[f,f,j,j,j,j]),c.createCubeMaterial(k)}}};return h}),e("extrovert/generators/tile",["require","extrovert/core","extrovert/providers/three/provider-three"],function(a,b,c){var d=function(){var b=a("extrovert/core"),d=null,e=null,f=null,g=null;return{options:{name:"tile",material:{color:16746564,friction:.2,restitution:1},block:{depth:"height"},clickForce:9e5,rows:10,cols:10,dims:[250,500,2]},init:function(a,g){d=a,e=g,b.createPlacementPlane([0,0,200]),f=c.createMaterial(a.material)},generate:function(a,f){g=a;for(var h=0;h<f.length;h++){var i=f[h],j=Math.floor(h/d.cols),k=h%d.cols,l=[k*d.dims[0],j*d.dims[1],0],m=null;m=a.rasterizer?"string"==typeof a.rasterizer?e.rasterizers[a.rasterizer]:a.rasterizer:b.getRasterizer(i);var n=a.adapt&&a.adapt(i)||i,o={width:d.dims[0],height:d.dims[1],bkColor:d.bkColor,textColor:d.textColor},p=m.paint(n,o,{}),q=c.createMaterial({tex:p,friction:.2,restitution:1});b.createObject({type:"box",pos:l,dims:d.dims,mat:q,mass:1e3})}}}};return d}),e("extrovert/controls/universal-controls",["require","../core"],function(b){return function(c,d,e){var f=b("../core");this.object=c,this.domElement=d||document,this.enabled=!0,this.movementSpeed=1500,this.turboMultiplier=1;var g={},h=!1,i=new a.Vector2,j=new a.Vector3,k=new a.Vector3,l=new a.Vector3,m=!1;this.update=function(b){if(g.lookAt)(this.object.parent||this.object).lookAt(new a.Vector3(0,500,0));else if(h&&m){var c=l.x;l.x=-l.y,l.y=c;var d=this.object.rotation.toVector3().add(l.multiplyScalar(.65));this.object.rotation.setFromVector3(d,"YXZ"),m=!1}g.zdir&&this.object.translateZ(this.movementSpeed*b*g.zdir*this.turboMultiplier),g.xdir&&this.object.translateX(this.movementSpeed*b*g.xdir*this.turboMultiplier),g.ydir&&this.object.translateY(this.movementSpeed*b*g.ydir*this.turboMultiplier),e.yFloor&&this.object.position.y<e.yFloor&&(this.object.position.y=e.yFloor)},this.mousedown=function(a){var b=void 0===a.offsetX?a.layerX:a.offsetX,c=void 0===a.offsetY?a.layerY:a.offsetY;i.set(b,c),j=f.toNDC(b,c,.5,j),h=!0,m=!1},this.mouseup=function(){h=!1,m=!1},this.mousemove=function(a){if(h){a.preventDefault();var b=void 0===a.offsetX?a.layerX:a.offsetX,c=void 0===a.offsetY?a.layerY:a.offsetY;if(b===i.x&&c===i.y)return;k=f.toNDC(b,c,.5,k),l.subVectors(j,k),m=!0,i.set(b,c),j=f.toNDC(b,c,.5,j)}},this.mousewheel=function(a){var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),this.object.translateZ(30*-b),a.preventDefault(),a.stopPropagation()},this.keydown=function(a){switch(a.keyCode){case 87:g.zdir=-1;break;case 83:g.zdir=1;break;case 65:g.xdir=-1;break;case 68:g.xdir=1;break;case 82:g.ydir=1;break;case 70:g.ydir=-1;break;case 32:g.lookAt=1;break;case 16:this.turboMultiplier=5}},this.keyup=function(a){switch(a.keyCode){case 87:g.zdir=0;break;case 83:g.zdir=0;break;case 65:g.xdir=0;break;case 68:g.xdir=0;break;case 82:g.ydir=0;break;case 70:g.ydir=0;break;case 32:g.lookAt=0;break;case 16:this.turboMultiplier=1}}}}),e("extrovert/core",["./options/version","./options/options","./options/defaults","./utilities/utils","./utilities/extend","./utilities/sel","./utilities/is","./utilities/log","./utilities/offset","./utilities/detect","./providers/three/provider-three","./rasterizers/paint-img","./rasterizers/paint-element","./rasterizers/paint-plain-text","./rasterizers/paint-plain-text-stream","./generators/book","./generators/box","./generators/direct","./generators/extrude","./generators/tile","./controls/universal-controls","physijs"],function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(a,b){return U.target=a,U.userOpts=b,V=U.opts=T.options=c.init(b),V.physics.enabled&&"physijs"===V.physics.provider&&(w.scripts.worker=V.physics.options.worker,w.scripts.ammo=V.physics.options.ammo),U.rasterizers={img:m,element:n,plain_text:o,plain_text_stream:p},U.generators={extrude:t,tile:u,book:q,direct:s,box:r},V}function y(a){var b=null;b=a.type?"string"==typeof a?new U.generators[a]:new U.generators[a.type]:new t;var c=f(!0,{},d,b.options);return c=f(!0,{},c,U.userOpts),c=f(!0,{},c,a),b.init&&b.init(c,U),b}function z(a,b){T.createScene(a);var c=a.init_cam_opts?f(!0,{},a.camera,a.init_cam_opts):a.camera;"orthographic"===c.type?(c.left=c.left||b.width/-2,c.right=c.right||b.width/2,c.top=c.top||b.height/2,c.bottom=c.bottom||b.height/-2):c.aspect=b.width/b.height;var d=T.provider.createCamera(c);T.LOGGING&&i.msg("Created camera at [%f,%f,%f]: %o",d.position.x,d.position.y,d.position.z,d),b.camera=d,a.controls.allow_drag&&(b.drag_plane=T.createObject({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0})),D(b.scene,a),b.scene.updateMatrix();var e=a.transform||a.transforms||[{type:"extrude",src:"img"}];e=h.array(e)?e:[e],e.reduce(function(b,c){var d=c.src||"*",e=c.container||a.src&&a.src.container||a.container||document.body;"string"==typeof e&&(e=g(e),void 0!==e.length&&(e=e[0]));var f="string"==typeof d?e.querySelectorAll(d):d,h=y(c);h.generate(c,f)},{});var j=a.camera;j.rotation&&b.camera.rotation.set(j.rotation[0],j.rotation[1],j.rotation[2],"YXZ"),j.positionNDC&&(j.position=T.ndcToWorld(j.positionNDC)),j.position&&(b.camera.position.set(j.position[0],j.position[1],j.position[2]),T.LOGGING&&i.msg("Camera moved to [%f,%f,%f]: %o",j.position[0],j.position[1],j.position[2],d)),l.fiatLux(a.lights).forEach(function(a){b.scene.add(a)})}function A(a,b){return b.controls=T.createControls(a.controls,b.camera,b.renderer.domElement),b.controls}function B(b){if(U.target){var c="string"==typeof U.target?g(U.target):U.target;void 0!==c.length&&(c=c[0]);var d=c.getBoundingClientRect();U.width=d.right-d.left,U.height=d.bottom-d.top}else U.width=window.innerWidth,U.height=window.innerHeight;var e=b.renderer;e&&"Any"!==e||(e=U.supportsWebGL?"WebGL":U.supportsCanvas?"Canvas":null);var f="Canvas"===e?void 0:{antialias:!0};T.LOGGING&&i.msg("Creating '%s' renderer with size %d x %d.",e,U.width,U.height),U.renderer=new a[e+"Renderer"](f),U.renderer.setPixelRatio(window.devicePixelRatio),U.renderer.setSize(U.width,U.height),b.bkcolor&&U.renderer.setClearColor(b.bkcolor),U.renderer.domElement.setAttribute("tabindex","0"),U.renderer.domElement.style+=" position: relative;"}function C(a){if(U.target){var b=a.action||"append",c="string"==typeof U.target?g(U.target):U.target;if(void 0!==c.length&&(c=c[0]),"replace"===b)for(;c.firstChild;)c.removeChild(c.firstChild);"replaceWith"!==b?c.appendChild(U.renderer.domElement):(c.parentNode.insertBefore(U.renderer.domElement,c),c.parentNode.removeChild(c))}}function D(a,b){if(b.scene&&b.scene.items)for(var c=0;c<b.scene.items.length;c++){var d=T.createObject(b.scene.items[c]);a.add(d)}}function E(a){a.physics.enabled&&(U.gravity.set(a.gravity[0],a.gravity[1],a.gravity[2]),U.scene.setGravity(U.gravity),U.scene.addEventListener("update",J))}function F(){e.registerEvent("extro.objectClick"),U.renderer.domElement.addEventListener("mousedown",M,!1),U.renderer.domElement.addEventListener("mouseup",O,!1),U.renderer.domElement.addEventListener("mousemove",N,!1),document.addEventListener("keydown",P,!1),document.addEventListener("keyup",Q,!1),U.renderer.domElement.addEventListener("wheel",R,!1),window.addEventListener("resize",S,!1)}function G(a){if(a&&a.enabled){var b=T.createObject(a);U.camera.position.set(0,0,0),b.add(U.camera),U.scene.add(b),U.objects.push(b)}}function H(){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},V.onload&&V.onload(),I()}function I(){requestAnimFrame(I),K()}function J(){U.scene.simulate()}function K(){if(V.physics.enabled&&J(),U.controls&&U.controls.enabled&&U.controls.update(U.clock.getDelta()),!V.move_with_physics){null!==U.selected&&(U.selected.__dirtyPosition=!0);for(var a=0,b=U.objects.length;b>a;a++)U.objects[a].has_been_touched&&(U.objects[a].__dirtyPosition=!0)}U.renderer.clear(),U.css_renderer&&U.css_renderer.render(U.css_scene,U.camera),U.renderer.render(U.scene,U.camera)}function L(b){if(V.physics.enabled){var c=(new a.Matrix4).extractRotation(b.object.matrix),d=b.face.normal.clone().negate().multiplyScalar(V.clickForce).applyMatrix4(c),e=b.point.clone().sub(b.object.position);b.object.applyImpulse(d,e)}}function M(b){b.preventDefault();var c=void 0===b.offsetX?b.layerX:b.offsetX,d=void 0===b.offsetY?b.layerY:b.offsetY;if(U.mouse=T.toNDC(c,d,.5,U.mouse),V.avatar){var f=new a.Vector3;f.setFromMatrixPosition(U.camera.matrixWorld),U.raycaster.ray.origin.copy(f),U.raycaster.ray.direction.set(U.mouse.x,U.mouse.y,.5).unproject(U.camera).sub(f).normalize()}else U.raycaster.setFromCamera(U.mouse,U.camera);var g=U.raycaster.intersectObjects(U.objects);if(0!==g.length){if(V.objectClicked&&!1===V.objectClicked(b,g))return;b.ctrlKey?(U.selected=g[0].object,U.selected.has_been_touched=!0,U.drag_plane.position.copy(U.selected.position),U.offset.copy(g[0].point).sub(U.selected.position),V.physics.enabled?(U.selected.setAngularFactor(e.VZERO),U.selected.setLinearFactor(e.VZERO),U.selected.setAngularVelocity(e.VZERO),U.selected.setLinearVelocity(e.VZERO)):(U.selected.temp_velocity=U.selected.velocity.clone(),U.selected.velocity.set(0,0,0))):L(g[0])}V.clicked&&V.clicked(b,U.selected),U.controls&&U.controls.enabled&&U.controls.mousedown(b)}function N(a){if(U.controls&&U.controls.enabled)return void U.controls.mousemove(a);a.preventDefault();var b=void 0===a.offsetX?a.layerX:a.offsetX,c=void 0===a.offsetY?a.layerY:a.offsetY;if(U.mouse=T.toNDC(b,c,.5,U.mouse),U.selected){U.raycaster.setFromCamera(U.mouse,U.camera);var d=U.raycaster.intersectObject(U.drag_plane);if(V.move_with_physics){var e=d[0].point.sub(U.selected.position);e.z=0,U.selected.setLinearVelocity(e)}else U.selected.position.copy(d[0].point.sub(U.offset)),U.selected.__dirtyPosition=!0}}function O(b){if(U.controls&&U.controls.enabled)return void U.controls.mouseup(b);if(b.preventDefault(),U.selected&&V.physics.enabled){if(V.physics.enabled){var c=new a.Vector3(1,1,1);U.selected.setAngularFactor(c),U.selected.setLinearFactor(c),U.selected.__dirtyPosition=!0}else{U.raycaster.setFromCamera(U.mouse,U.camera);var d=U.raycaster.intersectObject(U.drag_plane);U.selected.position.copy(d[0].point.sub(U.offset))}U.selected.updateMatrixWorld(),U.selected.updateMatrix()}U.selected=null}function P(a){U.controls&&U.controls.enabled&&U.controls.keydown(a)}function Q(a){U.controls&&U.controls.enabled&&U.controls.keyup(a)}function R(a){U.controls&&U.controls.enabled&&U.controls.mousewheel(a)}function S(){var a=U.renderer.domElement.parentNode.getBoundingClientRect();U.width=a.right-a.left,U.height=a.bottom-a.top,U.camera.aspect=U.width/U.height,U.camera.updateProjectionMatrix(),U.renderer.setSize(U.width,U.height)}var T={},U={camera:null,scene:null,renderer:null,raycaster:new a.Raycaster,mouse:new a.Vector2,width:100,height:100,gravity:new a.Vector3(d.gravity[0],d.gravity[1],d.gravity[2]),selected:null,start_time:0,last_time:0,objects:[],drag_plane:null,placement_plane:null,offset:new a.Vector3,generator:null,clock:new a.Clock,supportsWebGL:!1,supportsCanvas:!1,target:"body"},V=null;T.LOGGING=!0,T.init=function(c,d){if(d=d||{},T.provider=l,T.LOGGING&&i.msg("Extrovert %s",b.str),T.LOGGING&&i.msg("User options: %o",d),U.supportsWebGL=k.supportsWebGL(),U.supportsCanvas=k.supportsCanvas(),!U.supportsWebGL&&!U.supportsCanvas||"WebGL"===d.renderer&&!U.supportsWebGL||"Canvas"===d.renderer&&!U.supportsCanvas)return!1;var e=window.navigator.userAgent;return(~e.indexOf("MSIE ")||~e.indexOf("Trident/"))&&Object.keys(a.ShaderLib).forEach(function(b){a.ShaderLib[b].fragmentShader=a.ShaderLib[b].fragmentShader.replace("#extension GL_EXT_frag_depth : enable","")}),x(c,d),B(V),z(V,U),C(V),E(V),A(V,U),F(),G(V.avatar),H(),!0};var W=window.jQuery;return W&&(W.fn.extrovert=function(a){return this.each(function(){T.init(this,a)})}),T.getRasterizer=function(a){var b=null;return a instanceof HTMLImageElement?b=U.rasterizers.img:void 0!==a.nodeType?b=U.rasterizers.elem:T.Utils.isPlainObject(a)&&(b=U.rasterizers.plain_text),b},T.createObject=function(a){T.LOGGING&&i.msg("Creating object %o at [%f,%f,%f].",a,a.pos[0],a.pos[1],a.pos[2]);var b=T.provider.createObject(a);return U.scene.add(b),U.objects.push(b),b.updateMatrix(),b.updateMatrixWorld(),b},T.createControls=function(a,b){return"universal"===a.type?new v(b,void 0,a):null},T.createScene=function(b){return U.scene=b.physics.enabled?new w.Scene:new a.Scene,U.scene},T.screenToWorld=function(b,c,d,e){var f=T.toNDC(b,c,.5,new a.Vector2,e);U.raycaster.setFromCamera(f,U.camera);var g=d||U.placement_plane,h=U.raycaster.intersectObject(g);return h.length>0?h[0].point:null},T.ndcToWorld=function(b,c){var d=new a.Vector3(b[0],b[1],b[2]);U.raycaster.setFromCamera(d,U.camera);var e=c||U.placement_plane,f=U.raycaster.intersectObject(e);return f.length>0?[f[0].point.x,f[0].point.y,f[0].point.z]:null},T.getPosition=function(a,b,c,d){var e="string"==typeof b?g(b):b;

void 0!==e.length&&(e=e[0]);var f,h,i=j(e),k=j(a),l={left:k.left-i.left,top:k.top-i.top};d?(f={x:l.left,y:d-l.top,z:.5},h={x:f.x+a.offsetWidth,y:d-(l.top-a.offsetHeight),z:.5}):(f={x:l.left,y:l.top+a.offsetHeight,z:.5},h={x:f.x+a.offsetWidth,y:l.top,z:.5});var m=Math.abs(h.x-f.x),n=Math.abs(f.y-h.y);"width"===c?c=m:"height"===c&&(c=n);var o=c||Math.abs(f.z-h.z)||1;return{pos:[f.x+m/2,f.y-n/2,f.z-o/2],width:m,height:n,depth:o}},T.getPositionDirect=function(a,b,c,d){var e="string"==typeof b?g(b):b;void 0!==e.length&&(e=e[0]);var f=j(e),h=j(a),i={left:h.left-f.left,top:h.top-f.top},k={x:i.left,y:i.top,z:d||0},l={x:i.left+a.offsetWidth,y:i.top+a.offsetHeight,z:d||0},m=Math.abs(l.x-k.x),n=Math.abs(k.y-l.y);"width"===c?c=m:"height"===c&&(c=n);var o=c||Math.abs(k.z-l.z)||1;return{pos:[k.x+m/2,k.y-n/2,k.z-o/2],width:m,height:n,depth:o}},T.createPlacementPlane=function(b,c){c=c||[2e5,2e5,1];var d=new a.BoxGeometry(c[0],c[1],c[2]);return U.placement_plane=V.physics.enabled?new w.BoxMesh(d,new a.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new a.Mesh(d,new a.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),U.placement_plane.visible=!1,b&&U.placement_plane.position.set(b[0],b[1],b[2]),U.scene.updateMatrix(),U.placement_plane.updateMatrix(),U.placement_plane.updateMatrixWorld(),T.LOGGING&&i.msg("Created placement plane at [%o]: %o",U.placement_plane.position,U.placement_plane),U.placement_plane},T.toNDC=function(a,b,c,d,e){var f=(e||U).width,g=(e||U).height;return d.x=a/f*2-1,d.y=2*-(b/g)+1,d.z=c,d},T}),e("extrovert",["require","extrovert/options/version","extrovert/core","extrovert/utilities/utils"],function(a){"use strict";return{version:a("extrovert/options/version").str,init:a("extrovert/core").init,utils:a("extrovert/utilities/utils")}}),e("three",function(){return a}),e("physijs",function(){return b}),d("extrovert")});